<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="css/matrix-style2.css" />
<link rel="stylesheet" href="bootstrap-table/bootstrap-dialog.css" />

<link rel="stylesheet" href="css/bootstrap.min.css" />
<link rel="stylesheet" href="bootstrap-table/bootstrap-table.css"/>
<link href="font-awesome/css/font-awesome.css" rel="stylesheet" />

<script src="../js/jquery-3.5.1.min.js"></script> 
<script src="js/bootstrap.min.js"></script> 
<script src="bootstrap-table/bootstrap-table.js"></script>
<script src="bootstrap-table/bootstrap-dialog.js"></script>
<script src="bootstrap-table/bootstrap-table-zh-CN.js"></script>
<style>
.dh{width:100%;height:50px;}
.bt{width:25%;float:left;text-align:right;}
.mh{width:20%;float:left;text-align:center;}
.nr{width:50%;float:left;text-align:left;}
.nr1{float:left;text-align:left;}
.nr2{width:36%;float:left;text-align:left;}
.jbxx{width:100%;height:50px;line-height:30px;font-weight:bold;font-size:18px;}
</style>
</head>
<body>
<div id="body">
<div id="content">
  <div id="content-header">
      <h1>个人资料</h1>
  </div>
  <div class="container-fluid">
    <div class="row-fluid">
      <div class="span12">
        <div class="widget-box">
          <div class="widget-content">
		    <input type="hidden" class="form-control" name="sysId" id="sysId"/>
          	<div style="width:70%; border:1px solid #96c2f1;background:#eff7ff">
          		<div class="jbxx">&nbsp;基本信息</div>
          		<div class="dh">
			     	<div class="bt" style="color:red">登录账号</div>
			     	<div class="mh">:</div>
			     	<div class="nr" id="dlzh" style="color:red"></div>
          		</div>
          		<div class="dh">
			     	<div class="bt" style="color:red">管理员身份</div>
			     	<div class="mh">:</div>
			     	<div class="nr" id="glysf" style="color:red"></div>
          		</div>
          		<div class="dh">
			     	<div class="bt">真实姓名</div>
			     	<div class="mh">:</div>
			     	<div class="nr1" id="zsxm2"><span id="zsxm"></span>&nbsp;&nbsp;&nbsp;<span onclick="edit('zsxm')" onmouseover="this.style.cursor='pointer'"><i class='icon icon-edit'></i></span></div>
			     	<div class="nr2" style="display:none" id="zsxm1">
			     		<div style="float:left">
				     		<input type="text" style="width:48px;" class="form-control" name="realName" id="realName"/>
			     		</div>
			     		<div style="float:left;width:48px;text-align:center;margin-top:4px;color:blue;" onmouseover="this.style.cursor='pointer'" onclick="save('realName')">保存</div>
			     		<div style="float:left;width:48px;margin-top:4px;color:blue;" onmouseover="this.style.cursor='pointer'" onclick="replace()">取消</div>
			     	</div>
		     	</div>
		     	<div class="dh">
			     	<div class="bt">密码</div>
			     	<div class="mh">:</div>
			     	<div class="nr1" id="mm2"><span id="mm"></span>&nbsp;&nbsp;&nbsp;<span onclick="edit('mm')" onmouseover="this.style.cursor='pointer'"><i class='icon icon-edit'></i></span></div>
			     	<div class="nr2" style="display:none" id="mm1">
			     		<div style="float:left">
				     		<input type="text" style="width:140px;" class="form-control" name="passWord" id="passWord"/>
			     		</div>
			     		<div style="float:left;width:48px;text-align:center;margin-top:4px;color:blue;" onmouseover="this.style.cursor='pointer'" onclick="save('passWord')">保存</div>
			     		<div style="float:left;width:48px;margin-top:4px;color:blue;" onmouseover="this.style.cursor='pointer'" onclick="replace()">取消</div>
			     	</div>
          		</div>
          		<div class="dh">
			     	<div class="bt">邮箱</div>
			     	<div class="mh">:</div>
			     	<div class="nr1" id="yx2"><span id="yx"></span>&nbsp;&nbsp;&nbsp;<span onclick="edit('yx')" onmouseover="this.style.cursor='pointer'"><i class='icon icon-edit'></i></span></div>
			     	<div class="nr2" style="display:none" id="yx1">
			     		<div style="float:left">
				     		<input type="text" style="width:140px;" class="form-control" name="email" id="email"/>
			     		</div>
			     		<div style="float:left;width:48px;text-align:center;margin-top:4px;color:blue;" onmouseover="this.style.cursor='pointer'" onclick="save('email')">保存</div>
			     		<div style="float:left;width:48px;margin-top:4px;color:blue;" onmouseover="this.style.cursor='pointer'" onclick="replace()">取消</div>
			     	</div>
          		</div>
          		<div class="dh">
			     	<div class="bt">手机号</div>
			     	<div class="mh">:</div>
			     	<div class="nr1" id="sjh2"><span id="sjh"></span>&nbsp;&nbsp;&nbsp;<span onclick="edit('sjh')" onmouseover="this.style.cursor='pointer'"><i class='icon icon-edit'></i></span></div>
			     	<div class="nr2" style="display:none" id="sjh1">
			     		<div style="float:left">
				     		<input type="text" style="width:90px;" class="form-control" name="mobile" id="mobile"/>
			     		</div>
			     		<div style="float:left;width:48px;text-align:center;margin-top:4px;color:blue;" onmouseover="this.style.cursor='pointer'" onclick="save('mobile')">保存</div>
			     		<div style="float:left;width:48px;margin-top:4px;color:blue;" onmouseover="this.style.cursor='pointer'" onclick="replace()">取消</div>
			     	</div>
		     	</div>
          	</div>
          	<div style="width:100%;">
	          	<div class="jbxx" style="border-bottom:1px solid red;height:35px;">&nbsp;操作记录</div>
	          	<table id="table" style="white-space:nowrap;overflow: hidden"></table>
          	</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>
<script type="text/javascript">
$(function(){
	showUser();
});
function showUser(){
	$.ajax({
		type:'POST',
		url:"/msUser/getMsUser?token="+localStorage.getItem("token"),
		contentType:'application/json',
		success:function(res){
			if(res.status == '01'){
				$("#sysId").val(res.rows.sysId)
				$("#dlzh").html(res.rows.userName)
				$("#yx").html(res.rows.email)
				$("#zsxm").html(res.rows.realName)
				$("#glysf").html(res.rows.roleName)
				$("#realName").val(res.rows.realName)
				$("#mobile").val(res.rows.mobile)
				$("#sjh").html(res.rows.mobile)
				$("#email").val(res.rows.email)
				$("#yx").html(res.rows.email)
				$("#passWord").val(res.rows.passWord)
				$("#mm").html(res.rows.passWord)
				init();
			}else{
				alert(res.message)
			}
		}
	})
}
function edit(id){
	$("#"+id).hide()
	$("#"+id+"2").hide()
	$("#"+id+"1").show()
}
function save(id){
	var key = id;
    var value = $("#"+id).val();
	var data = {"sysId":$("#sysId").val()};
	data[key] = value;
	$.ajax({
		type:"post",
		url:"/msUser/updateMsUserBySysId?token="+localStorage.getItem("token"),
		contentType:'application/json',
		data:JSON.stringify(data),
		success:function(res){
			if(res.status=="01"){
				alert(res.message)
				window.location.reload()
			}else{
				alert(res.message)
			}
		}
	})
}
function replace(){
	window.location.reload()
}
function init(){
	$('#table').bootstrapTable('destroy').bootstrapTable({
	    url: '/logInfo/getLogInfoList',
	    pagination: true,
	    method:"post",
	    height:"400",
	    queryParams : function(params) {//上传服务器的参数
	    	var temp = {
	    		userName:$("#dlzh").html(),
	    		type:"0",
	            offset :params.offset + 0,// SQL语句起始索引
	            pageNumber : params.limit  // 每页显示数量
	        };
	        return temp;
	    },
	    responseHandler:function(res){
	    	if(res.status == "01"){
	    		return res;
	    	}else{
	    		return res.message;
	    	}
	    },
	    columns: [{
	   	    field: 'id',
	   	    title: '序号',
	   	    formatter: function (value, row, index) {
	   	        return index+1;
	   	    }
	   	},{
	    	field: 'sysId',
	    	align:'center',
	        title: '主键',
	        visible: false
	    }, {
	        field: 'userName',
	        align:'center',
	        title: '操作账号'
	    }, {
	        field: 'remark',
	        align:'left',
	        halign:"center",
	        title: '操作说明',
	        formatter:paramsMatter,
	        cellStyle:formatTableUnit
	    }, {
	        field: 'operation',
	        align:'center',
	        title: '操作类型'
	    }, {
	        field: 'method',
	        align:'left',
	        halign:"center",
	        title: '请求方法',
	        formatter:paramsMatter,
	        cellStyle:formatTableUnit
	    }, {
	        field: 'result',
	        align:'center',
	        title: '请求结果',
	        formatter:paramsMatter,
	        cellStyle:formatTableUnit
	    }, {
	        field: 'content',
	        align:'left',
	        halign:"center",
	        title: '内容',
	        formatter:paramsMatter,
	        cellStyle:formatTableUnit
	    }, {
	        field: 'createTime',
	        align:'center',
	        title: '操作时间'
	    }]
	});
}
//表格超出宽度鼠标悬停显示td内容
function paramsMatter(value, row, index) {
    var span = document.createElement("span");
    span.setAttribute("title", value);
    span.innerHTML = value;
    return span.outerHTML;
}
//td宽度以及内容超过宽度隐藏
function formatTableUnit(value, row, index) {
    return {
        css: {
            "white-space": "nowrap",
            "text-overflow": "ellipsis",
            "overflow": "hidden",
            "max-width": "150px"
        }
    }
} 
</script>
<script src="getMsUser.js"></script>
</body>
</html>
